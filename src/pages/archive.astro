---
import type { ArchiveProject } from '../lib/types';
import { client, urlFor } from '../lib/sanity';
import Navigation from '../components/Navigation.astro';
import BaseLayout from '../layouts/BaseLayout.astro';
import Video from '../components/Video.astro';
import HoverCursor from '../components/HoverCursor.astro';
import ContentWarning from '../components/ContentWarning.astro';
const query = `*[_type == 'archiveProject'] |  order(title asc) | order(rating desc) {
	title,
	media {
		mediaType,
		image {asset},
		video {asset->{playbackId}},
		thumbnail {asset}
	},
	sensitiveContent,
	layout
}`;

const projects = await client.fetch<ArchiveProject[]>(query);
---

<style lang="scss">
	@use '../styles/layouts/archive';
	@use '../styles/components/video';
</style>

<BaseLayout title="Archive">
	<Navigation />
	<header class="hidden" aria-hidden="true">
		<p class="text-link">Sean Do</p>
	</header>
	<section class="archive-heading">
		<h1>ARCHIVE</h1>
		<p>A collection of smaller projects and visual experimentations.</p>
	</section>
	<section class="archive-grid">
		<HoverCursor target=".video-wrapper" text="(PLAY)" />
		<HoverCursor target=".archive-item--sensitive" text="(SHOW)" />

		{
			projects.map(({ title, media, sensitiveContent, layout }) => {
				const { mediaType, image, video, thumbnail } = media;
				const { isSensitiveContent } = sensitiveContent ?? {};
				if (mediaType === 'video' && video) {
					return (
						<div class={`video-wrapper archive-item--${layout}`}>
							<Video
								title={title}
								playbackId={video.asset.playbackId}
								thumbnail={thumbnail ? urlFor(thumbnail.asset).url() : undefined}
							/>
						</div>
					);
				}
				if (mediaType === 'image' && image) {
					if (!isSensitiveContent)
						return (
							<div class={`archive-item--${layout}}`}>
								<img src={urlFor(image.asset).url()} alt={title} loading="lazy" />
							</div>
						);
					else
						return (
							<div class={`archive-item--${layout} archive-item--sensitive`}>
								<ContentWarning sensitiveContent={sensitiveContent} />

								<img src={urlFor(image.asset).url()} alt={title} loading="lazy" />
							</div>
						);
				}
			})
		}
	</section>
</BaseLayout>
